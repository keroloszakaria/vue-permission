"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const F=require("vue"),y=new Map,G=e=>y.has(e)?y.get(e):null,J=(e,s)=>y.set(e,s),I=()=>y.clear(),M="__v_permission__",T=e=>btoa(JSON.stringify(e)),j=e=>JSON.parse(atob(e)),K=e=>{try{localStorage.setItem(M,T(e))}catch(s){console.warn("[v-permission] Failed to save permissions to storage:",s)}},B=()=>{try{const e=localStorage.getItem(M);return e?j(e):null}catch(e){return console.warn("[v-permission] Failed to read permissions from storage:",e),null}};let q={permissions:null},S=!1;const _=(e,s)=>{q.permissions=e,S=(s==null?void 0:s.developmentMode)??!1,I(),K(e)},N=()=>{const e=B();e&&_(e)},W=()=>{const{permissions:e}=q;return F.isRef(e)?e.value:e??[]},m=async(e,s)=>{const i=s??W(),u=JSON.stringify({permissionValue:e,currentPermissions:i}),f=G(u);if(f!==null)return f;const c=await(async n=>{var h;if(typeof n=="string")return i.includes(n);if(Array.isArray(n))return(await Promise.all(n.map(r=>m(r,i)))).some(Boolean);if(typeof n=="object"&&n.permissions&&n.mode){const{permissions:r,mode:P}=n,l={and:()=>r.every(t=>i.includes(t)),or:()=>r.some(t=>i.includes(t)),startWith:()=>r.some(t=>i.some(o=>o.startsWith(t))),endWith:()=>r.some(t=>i.some(o=>o.endsWith(t))),exact:()=>r.some(t=>i.includes(t)),regex:()=>r.some(t=>{try{const o=new RegExp(t);return i.some(v=>o.test(v))}catch(o){return S&&console.warn("[v-permission] Invalid regex:",t,o),!1}})};return((h=l[P])==null?void 0:h.call(l))??!1}return S&&console.warn("[v-permission] Invalid permission value:",n),!1})(e);return J(u,c),c},E={async mounted(e,s){const i=s.value;await m(i)||(e._vPermissionOriginalDisplay=e.style.display,e.style.display="none")},async updated(e,s){if(s.value!==s.oldValue){const i=await m(s.value);e.style.display=i?e._vPermissionOriginalDisplay||"":"none"}},unmounted(e){e._vPermissionOriginalDisplay=void 0}},Y={install(e,s){s!=null&&s.permissions?_(s.permissions,{developmentMode:s.developmentMode}):N(),e.directive("permission",E)}};async function k(e,s,i,u={}){var O;const{authRoutes:f=[],protectedRoutes:A=[],getAuthState:c,loginPath:n="/login",homePath:h="/"}=u,r=(c==null?void 0:c())??{isAuthenticated:!1},{isAuthenticated:P}=r,l=W(),t=f.some(a=>a.path===e.path),o=(O=e.meta)==null?void 0:O.requiresAuth,v=async()=>{var p,d;if(!((p=e.meta)!=null&&p.checkPermission))return!0;const a=(d=e.meta)==null?void 0:d.permissions;return!a||a==="*"?!0:await m(a,l)},b=async(a,p="")=>{var d,C;for(const g of a){const R=p+g.path,w=(d=g.meta)==null?void 0:d.permissions;if(!w||w==="*"||await m(w,l))return R;if((C=g.children)!=null&&C.length){const D=await b(g.children,R);if(D)return D}}return null};if(!P)return o?i(n):i();if(t)return i(h);if(!await v()){const a=await b(A);return i(a||n)}i()}exports.PermissionPlugin=Y;exports.clearPermissionCache=I;exports.configurePermission=_;exports.globalGuard=k;exports.hasPermission=m;exports.initPermissionDirectiveIfNeeded=N;exports.vPermission=E;
