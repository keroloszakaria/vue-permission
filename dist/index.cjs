"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const F=require("vue"),y=new Map,G=e=>y.has(e)?y.get(e):null,J=(e,s)=>y.set(e,s),S=()=>y.clear(),q="__v_permission__",T=e=>btoa(JSON.stringify(e)),j=e=>JSON.parse(atob(e)),K=e=>{try{localStorage.setItem(q,T(e))}catch(s){console.warn("[v-permission] Failed to save permissions to storage:",s)}},B=()=>{try{const e=localStorage.getItem(q);return e?j(e):null}catch(e){return console.warn("[v-permission] Failed to read permissions from storage:",e),null}};let N={permissions:null},_=!1;const A=(e,s)=>{N.permissions=e,_=(s==null?void 0:s.developmentMode)??!1,S(),K(e)},W=()=>{const e=B();e&&A(e)},Y=()=>{const{permissions:e}=N;return F.isRef(e)?e.value:e??[]},m=async(e,s)=>{const i=s??Y(),u=JSON.stringify({permissionValue:e,currentPermissions:i}),f=G(u);if(f!==null)return f;const c=await(async t=>{var p;if(typeof t=="string")return i.includes(t);if(Array.isArray(t))return(await Promise.all(t.map(n=>m(n,i)))).some(Boolean);if(typeof t=="object"&&t.permissions&&t.mode){const{permissions:n,mode:P}=t,l={and:()=>n.every(r=>i.includes(r)),or:()=>n.some(r=>i.includes(r)),startWith:()=>n.some(r=>i.some(o=>o.startsWith(r))),endWith:()=>n.some(r=>i.some(o=>o.endsWith(r))),exact:()=>n.some(r=>i.includes(r)),regex:()=>n.some(r=>{try{const o=new RegExp(r);return i.some(v=>o.test(v))}catch(o){return _&&console.warn("[v-permission] Invalid regex:",r,o),!1}})};return((p=l[P])==null?void 0:p.call(l))??!1}return _&&console.warn("[v-permission] Invalid permission value:",t),!1})(e);return J(u,c),c},E={async mounted(e,s){const i=s.value;await m(i)||(e._vPermissionOriginalDisplay=e.style.display,e.style.display="none")},async updated(e,s){if(s.value!==s.oldValue){const i=await m(s.value);e.style.display=i?e._vPermissionOriginalDisplay||"":"none"}},unmounted(e){e._vPermissionOriginalDisplay=void 0}},k={install(e,s){s!=null&&s.permissions?A(s.permissions,{developmentMode:s.developmentMode}):W(),e.directive("permission",E)}};async function x(e,s,i,u={}){var C,R;const{authRoutes:f=[],protectedRoutes:b=[],getAuthState:c,loginPath:t="/login",homePath:p="/"}=u,n=(c==null?void 0:c())??{isAuthenticated:!1},{isAuthenticated:P}=n,l=(n==null?void 0:n.permissions)||((C=n==null?void 0:n.user)==null?void 0:C.permissions)||[],r=f.some(a=>a.path===e.path),o=(R=e.meta)==null?void 0:R.requiresAuth,v=async()=>{var h,d;if(!((h=e.meta)!=null&&h.checkPermission))return!0;const a=(d=e.meta)==null?void 0:d.permissions;return!a||a==="*"?!0:await m(a,l)},O=async(a,h="")=>{var d,D;for(const g of a){const I=h+g.path,w=(d=g.meta)==null?void 0:d.permissions;if(!w||w==="*"||await m(w,l))return I;if((D=g.children)!=null&&D.length){const M=await O(g.children,I);if(M)return M}}return null};if(!P)return o?i(t):i();if(r)return i(p);if(!await v()){const a=await O(b);return i(a||t)}i()}exports.PermissionPlugin=k;exports.clearPermissionCache=S;exports.configurePermission=A;exports.globalGuard=x;exports.hasPermission=m;exports.initPermissionDirectiveIfNeeded=W;exports.vPermission=E;
