"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const F=require("vue"),P=new Map,G=e=>P.has(e)?P.get(e):null,J=(e,s)=>P.set(e,s),I=()=>P.clear(),M="__v_permission__",T=e=>btoa(JSON.stringify(e)),j=e=>JSON.parse(atob(e)),K=e=>{try{localStorage.setItem(M,T(e))}catch(s){console.warn("[v-permission] Failed to save permissions to storage:",s)}},B=()=>{try{const e=localStorage.getItem(M);return e?j(e):null}catch(e){return console.warn("[v-permission] Failed to read permissions from storage:",e),null}};let q={permissions:null},S=!1;const _=(e,s)=>{q.permissions=e,S=(s==null?void 0:s.developmentMode)??!1,I(),K(e)},N=()=>{const e=B();e&&_(e)},W=()=>{const{permissions:e}=q;return F.isRef(e)?e.value:e??[]},m=async(e,s)=>{const t=s??W(),u=JSON.stringify({permissionValue:e,currentPermissions:t}),h=G(u);if(h!==null)return h;const c=await(async n=>{var p;if(typeof n=="string")return t.includes(n);if(Array.isArray(n))return(await Promise.all(n.map(d=>m(d,t)))).some(Boolean);if(typeof n=="object"&&n.permissions&&n.mode){const{permissions:r,mode:d}=n,l={and:()=>r.every(i=>t.includes(i)),or:()=>r.some(i=>t.includes(i)),startWith:()=>r.some(i=>t.some(o=>o.startsWith(i))),endWith:()=>r.some(i=>t.some(o=>o.endsWith(i))),exact:()=>r.some(i=>t.includes(i)),regex:()=>r.some(i=>{try{const o=new RegExp(i);return t.some(v=>o.test(v))}catch(o){return S&&console.warn("[v-permission] Invalid regex:",i,o),!1}})};return((p=l[d])==null?void 0:p.call(l))??!1}return S&&console.warn("[v-permission] Invalid permission value:",n),!1})(e);return J(u,c),c},E={async mounted(e,s){const t=s.value;await m(t)||(e._vPermissionOriginalDisplay=e.style.display,e.style.display="none")},async updated(e,s){if(s.value!==s.oldValue){const t=await m(s.value);e.style.display=t?e._vPermissionOriginalDisplay||"":"none"}},unmounted(e){e._vPermissionOriginalDisplay=void 0}},Y={install(e,s){s!=null&&s.permissions?_(s.permissions,{developmentMode:s.developmentMode}):N(),e.directive("permission",E)}};async function k(e,s,t,u={}){var O;const{authRoutes:h=[],protectedRoutes:A=[],getAuthState:c,loginPath:n="/login",homePath:p="/"}=u,r=(c==null?void 0:c())??{isAuthenticated:!1},{isAuthenticated:d}=r,l=W(),i=h.some(a=>a.path===e.path),o=(O=e.meta)==null?void 0:O.requiresAuth,v=async()=>{var g,f;if(!((g=e.meta)!=null&&g.checkPermission))return!0;const a=(f=e.meta)==null?void 0:f.permissions;return!a||a==="*"?!0:await m(a,l)},b=async(a,g="")=>{var f,C;for(const y of a){const R=g+y.path,w=(f=y.meta)==null?void 0:f.permissions;if(!w||w==="*"||await m(w,l))return R;if((C=y.children)!=null&&C.length){const D=await b(y.children,R);if(D)return D}}return null};if(!d)return o?t(n):t();if(i)return t(p);if(!await v()){const a=await b(A);return t(a||n)}t()}exports.PermissionPlugin=Y;exports.clearPermissionCache=I;exports.configurePermission=_;exports.globalGuard=k;exports.hasPermission=m;exports.initPermissionDirectiveIfNeeded=N;exports.vPermission=E;
