"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const q=require("vue"),g=new Map,E=e=>g.has(e)?g.get(e):null,F=(e,s)=>g.set(e,s),R=()=>g.clear(),I="__v_permission__",G=e=>btoa(JSON.stringify(e)),J=e=>JSON.parse(atob(e)),T=e=>{try{localStorage.setItem(I,G(e))}catch(s){console.warn("[v-permission] Failed to save permissions to storage:",s)}},j=()=>{try{const e=localStorage.getItem(I);return e?J(e):null}catch(e){return console.warn("[v-permission] Failed to read permissions from storage:",e),null}};let M={permissions:null},w=!1;const S=(e,s)=>{M.permissions=e,w=(s==null?void 0:s.developmentMode)??!1,R(),T(e)},N=()=>{const e=j();e&&S(e)},K=()=>{const{permissions:e}=M;return q.isRef(e)?e.value:e??[]},c=async e=>{const s=K(),n=JSON.stringify(e),l=E(n);if(l!==null)return l;const f=await(async t=>{var m;if(typeof t=="string")return s.includes(t);if(Array.isArray(t))return(await Promise.all(t.map(c))).some(Boolean);if(typeof t=="object"&&t.permissions&&t.mode){const{permissions:a,mode:y}=t,u={and:()=>a.every(i=>s.includes(i)),or:()=>a.some(i=>s.includes(i)),startWith:()=>a.some(i=>s.some(r=>r.startsWith(i))),endWith:()=>a.some(i=>s.some(r=>r.endsWith(i))),exact:()=>a.some(i=>s.includes(i)),regex:()=>a.some(i=>{try{const r=new RegExp(i);return s.some(v=>r.test(v))}catch(r){return w&&console.warn("[v-permission] Invalid regex:",i,r),!1}})};return((m=u[y])==null?void 0:m.call(u))??!1}return w&&console.warn("[v-permission] Invalid permission value:",t),!1})(e);return F(n,f),f},W={async mounted(e,s){const n=s.value;await c(n)||(e._vPermissionOriginalDisplay=e.style.display,e.style.display="none")},async updated(e,s){if(s.value!==s.oldValue){const n=await c(s.value);e.style.display=n?e._vPermissionOriginalDisplay||"":"none"}},unmounted(e){e._vPermissionOriginalDisplay=void 0}},B={install(e,s){s!=null&&s.permissions?S(s.permissions,{developmentMode:s.developmentMode}):N(),e.directive("permission",W)}};async function Y(e,s,n,l={}){var b;const{authRoutes:_=[],protectedRoutes:f=[],getAuthState:t,loginPath:m="/login",homePath:a="/"}=l,y=(t==null?void 0:t())??{isAuthenticated:!1},{isAuthenticated:u}=y,i=_.some(o=>o.path===e.path),r=(b=e.meta)==null?void 0:b.requiresAuth,v=async()=>{var h,d;if(!((h=e.meta)!=null&&h.checkPermission))return!0;const o=(d=e.meta)==null?void 0:d.permissions;return!o||o==="*"?!0:await c(o)},A=async(o,h="")=>{var d,D;for(const p of o){const O=h+p.path,P=(d=p.meta)==null?void 0:d.permissions;if(!P||P==="*"||await c(P))return O;if((D=p.children)!=null&&D.length){const C=await A(p.children,O);if(C)return C}}return null};if(!u)return r?n(m):n();if(i)return n(a);if(!await v()){const o=await A(f);return n(o||m)}n()}exports.PermissionPlugin=B;exports.clearPermissionCache=R;exports.configurePermissionDirective=S;exports.globalGuard=Y;exports.hasPermission=c;exports.initPermissionDirectiveIfNeeded=N;exports.vPermission=W;
